import shutil
import os
import time
from datetime import datetime

# Rutas de los archivos fuente y destino
entornos = {
    "DEV": "C:/temp/DEV",
    "UAT": "C:/temp/UAT",
    "PROD": "C:/temp/PROD"
}
dest_path = "C:/Copialogs"

def copiar_logs():
    mes_actual = datetime.now().strftime("%m")  # Número del mes
    anio_actual = datetime.now().strftime("%Y")
    mes_nombre = datetime.now().strftime("%B")  # Nombre del mes en español
    
    for entorno, ruta_base in entornos.items():
        source_file = f"{ruta_base}/{anio_actual}/{mes_nombre}/log.csv"
        dest_file = f"{dest_path}/{mes_actual}-{anio_actual}-{entorno}log.csv"
        
        if os.path.exists(source_file):
            shutil.copy2(source_file, dest_file)
            print(f"{datetime.now()} - Copiado: {source_file} -> {dest_file}")
        else:
            print(f"{datetime.now()} - No se encontró: {source_file}")

# Ejecutar cada 15 minutos
if not os.path.exists(dest_path):
    os.makedirs(dest_path)

while True:
    copiar_logs()
    time.sleep(900)  # 900 segundos = 15 minutos
