import os, pandas as pd

def limpiar_tabla_aclarapp(archivo_entrada, archivo_salida=None):
    """Limpia el archivo copiado de la web y extrae solo la tabla"""
    
    # Leer como texto
    with open(archivo_entrada, 'r', encoding='utf-8') as f:
        texto = f.read()
    
    # Dividir en líneas
    lineas = [l.strip() for l in texto.split('\n') if l.strip()]
    
    # Buscar inicio de tabla (ID Aclaración)
    start = -1
    for i, linea in enumerate(lineas):
        if 'ID Aclaración' in linea:
            start = i
            break
    
    if start == -1:
        print("❌ No se encontró la tabla")
        return None
    
    # Los encabezados (asumiendo formato)
    headers = ['ID Aclaración', 'Registro', 'Folio', 'CIS', 'Fecha Creación',
               'Fecha Enviado', 'Fecha Asignacion', 'Fecha Atendido',
               'Estado Actual', 'Intentos', 'Acciones']
    
    # Recoger datos
    datos = []
    for i in range(start+1, len(lineas)):
        if 'Mostrando' in lineas[i]:
            break
        
        # Separar por tabs o espacios múltiples
        if '\t' in lineas[i]:
            fila = lineas[i].split('\t')
        else:
            # Para espacios múltiples
            fila = [x for x in lineas[i].split('  ') if x]
        
        if len(fila) >= 11:
            datos.append(fila[:11])
    
    # Crear DataFrame
    df = pd.DataFrame(datos, columns=headers)
    
    # Guardar
    if archivo_salida:
        os.makedirs(os.path.dirname(archivo_salida), exist_ok=True)
        df.to_csv(archivo_salida, index=False, encoding='utf-8-sig')
        print(f"✅ Tabla guardada: {archivo_salida} ({len(df)} filas)")
    
    return df

# Uso simple:
ruta_original = "c:/Copia-reporte-Aclarabot/Copy-Aclarapp/TablaCopiadaDeAclarapp.csv"
ruta_limpia = ruta_original.replace('.csv', '_LIMPIADO.csv')

df = limpiar_tabla_aclarapp(ruta_original, ruta_limpia)
if df is not None:
    print("\nPrimeras filas:")
    print(df.head())
